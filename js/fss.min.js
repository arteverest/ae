/*!
//============================================================
//
// Copyright (C) 2013 Matthew Wagerfield
//
// Twitter: https://twitter.com/mwagerfield
//
// Permission is hereby granted, free of charge, to any
// person obtaining a copy of this software and associated
// documentation files (the "Software"), to deal in the
// Software without restriction, including without limitation
// the rights to use, copy, modify, merge, publish, distribute,
// sublicense, and/or sell copies of the Software, and to
// permit persons to whom the Software is furnished to do
// so, subject to the following conditions:
//
// The above copyright notice and this permission notice
// shall be included in all copies or substantial portions
// of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY
// OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
// LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
// FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO
// EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
// FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
// AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE
// OR OTHER DEALINGS IN THE SOFTWARE.
//
//============================================================
*/FSS={FRONT:0,BACK:1,DOUBLE:2,SVGNS:"http://www.w3.org/2000/svg"},FSS.Array="function"==typeof Float32Array?Float32Array:Array,FSS.Utils={isNumber:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;t.length>n&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),Math.PIM2=2*Math.PI,Math.PID2=Math.PI/2,Math.randomInRange=function(e,t){return e+(t-e)*Math.random()},Math.clamp=function(e,t,n){return e=Math.max(e,t),e=Math.min(e,n)},FSS.Vector3={create:function(e,t,n){var r=new FSS.Array(3);return this.set(r,e,t,n),r},clone:function(e){var t=this.create();return this.copy(t,e),t},set:function(e,t,n,r){return e[0]=t||0,e[1]=n||0,e[2]=r||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],this},addVectors:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],this},addScalar:function(e,t){return e[0]+=t,e[1]+=t,e[2]+=t,this},subtract:function(e,t){return e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],this},subtractVectors:function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],this},subtractScalar:function(e,t){return e[0]-=t,e[1]-=t,e[2]-=t,this},multiply:function(e,t){return e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],this},multiplyVectors:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,this},divide:function(e,t){return e[0]/=t[0],e[1]/=t[1],e[2]/=t[2],this},divideVectors:function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],this},divideScalar:function(e,t){return 0!==t?(e[0]/=t,e[1]/=t,e[2]/=t):(e[0]=0,e[1]=0,e[2]=0),this},cross:function(e,t){var n=e[0],r=e[1],i=e[2];return e[0]=r*t[2]-i*t[1],e[1]=i*t[0]-n*t[2],e[2]=n*t[1]-r*t[0],this},crossVectors:function(e,t,n){return e[0]=t[1]*n[2]-t[2]*n[1],e[1]=t[2]*n[0]-t[0]*n[2],e[2]=t[0]*n[1]-t[1]*n[0],this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),this},clamp:function(e,t,n){return this.min(e,t),this.max(e,n),this},limit:function(e,t,n){var r=this.length(e);return null!==t&&t>r?this.setLength(e,t):null!==n&&r>n&&this.setLength(e,n),this},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},normalise:function(e){return this.divideScalar(e,this.length(e))},negate:function(e){return this.multiplyScalar(e,-1)},distanceSquared:function(e,t){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i},distance:function(e,t){return Math.sqrt(this.distanceSquared(e,t))},lengthSquared:function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},length:function(e){return Math.sqrt(this.lengthSquared(e))},setLength:function(e,t){var n=this.length(e);return 0!==n&&t!==n&&this.multiplyScalar(e,t/n),this}},FSS.Vector4={create:function(e,t,n){var r=new FSS.Array(4);return this.set(r,e,t,n),r},set:function(e,t,n,r,i){return e[0]=t||0,e[1]=n||0,e[2]=r||0,e[3]=i||0,this},setX:function(e,t){return e[0]=t||0,this},setY:function(e,t){return e[1]=t||0,this},setZ:function(e,t){return e[2]=t||0,this},setW:function(e,t){return e[3]=t||0,this},add:function(e,t){return e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],this},multiplyVectors:function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],this},multiplyScalar:function(e,t){return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,this},min:function(e,t){return t>e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),t>e[2]&&(e[2]=t),t>e[3]&&(e[3]=t),this},max:function(e,t){return e[0]>t&&(e[0]=t),e[1]>t&&(e[1]=t),e[2]>t&&(e[2]=t),e[3]>t&&(e[3]=t),this},clamp:function(e,t,n){return this.min(e,t),this.max(e,n),this}},FSS.Color=function(e,t){this.rgba=FSS.Vector4.create(),this.hex=e||"#000000",this.opacity=FSS.Utils.isNumber(t)?t:1,this.set(this.hex,this.opacity)},FSS.Color.prototype={set:function(e,t){e=e.replace("#","");var n=e.length/3;return this.rgba[0]=parseInt(e.substring(0*n,1*n),16)/255,this.rgba[1]=parseInt(e.substring(1*n,2*n),16)/255,this.rgba[2]=parseInt(e.substring(2*n,3*n),16)/255,this.rgba[3]=FSS.Utils.isNumber(t)?t:this.rgba[3],this},hexify:function(e){var t=Math.ceil(255*e).toString(16);return 1===t.length&&(t="0"+t),t},format:function(){var e=this.hexify(this.rgba[0]),t=this.hexify(this.rgba[1]),n=this.hexify(this.rgba[2]);return this.hex="#"+e+t+n,this.hex}},FSS.Object=function(){this.position=FSS.Vector3.create()},FSS.Object.prototype={setPosition:function(e,t,n){return FSS.Vector3.set(this.position,e,t,n),this}},FSS.Light=function(e,t){FSS.Object.call(this),this.ambient=new FSS.Color(e||"#FFFFFF"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.ray=FSS.Vector3.create()},FSS.Light.prototype=Object.create(FSS.Object.prototype),FSS.Vertex=function(e,t,n){this.position=FSS.Vector3.create(e,t,n)},FSS.Vertex.prototype={setPosition:function(e,t,n){return FSS.Vector3.set(this.position,e,t,n),this}},FSS.Triangle=function(e,t,n){this.a=e||new FSS.Vertex,this.b=t||new FSS.Vertex,this.c=n||new FSS.Vertex,this.vertices=[this.a,this.b,this.c],this.u=FSS.Vector3.create(),this.v=FSS.Vector3.create(),this.centroid=FSS.Vector3.create(),this.normal=FSS.Vector3.create(),this.color=new FSS.Color,this.polygon=document.createElementNS(FSS.SVGNS,"polygon"),this.polygon.setAttributeNS(null,"stroke-linejoin","round"),this.polygon.setAttributeNS(null,"stroke-miterlimit","1"),this.polygon.setAttributeNS(null,"stroke-width","1"),this.computeCentroid(),this.computeNormal()},FSS.Triangle.prototype={computeCentroid:function(){return this.centroid[0]=this.a.position[0]+this.b.position[0]+this.c.position[0],this.centroid[1]=this.a.position[1]+this.b.position[1]+this.c.position[1],this.centroid[2]=this.a.position[2]+this.b.position[2]+this.c.position[2],FSS.Vector3.divideScalar(this.centroid,3),this},computeNormal:function(){return FSS.Vector3.subtractVectors(this.u,this.b.position,this.a.position),FSS.Vector3.subtractVectors(this.v,this.c.position,this.a.position),FSS.Vector3.crossVectors(this.normal,this.u,this.v),FSS.Vector3.normalise(this.normal),this}},FSS.Geometry=function(){this.vertices=[],this.triangles=[],this.dirty=!1},FSS.Geometry.prototype={update:function(){if(this.dirty){var e,t;for(e=this.triangles.length-1;e>=0;e--)t=this.triangles[e],t.computeCentroid(),t.computeNormal();this.dirty=!1}return this}},FSS.Plane=function(e,t,n,r){FSS.Geometry.call(this),this.width=e||100,this.height=t||100,this.segments=n||4,this.slices=r||4,this.segmentWidth=this.width/this.segments,this.sliceHeight=this.height/this.slices;var i,s,o,u,a,f,l,c=[],h=this.width*-0.5,p=.5*this.height;for(i=0;this.segments>=i;i++)for(c.push([]),s=0;this.slices>=s;s++)l=new FSS.Vertex(h+i*this.segmentWidth,p-s*this.sliceHeight),c[i].push(l),this.vertices.push(l);for(i=0;this.segments>i;i++)for(s=0;this.slices>s;s++)o=c[i+0][s+0],u=c[i+0][s+1],a=c[i+1][s+0],f=c[i+1][s+1],t0=new FSS.Triangle(o,u,a),t1=new FSS.Triangle(a,u,f),this.triangles.push(t0,t1)},FSS.Plane.prototype=Object.create(FSS.Geometry.prototype),FSS.Material=function(e,t){this.ambient=new FSS.Color(e||"#444444"),this.diffuse=new FSS.Color(t||"#FFFFFF"),this.slave=new FSS.Color},FSS.Mesh=function(e,t){FSS.Object.call(this),this.geometry=e||new FSS.Geometry,this.material=t||new FSS.Material,this.side=FSS.FRONT,this.visible=!0},FSS.Mesh.prototype=Object.create(FSS.Object.prototype),FSS.Mesh.prototype.update=function(e,t){var n,r,i,s,o;if(this.geometry.update(),t)for(n=this.geometry.triangles.length-1;n>=0;n--){for(r=this.geometry.triangles[n],FSS.Vector4.set(r.color.rgba),i=e.length-1;i>=0;i--)s=e[i],FSS.Vector3.subtractVectors(s.ray,s.position,r.centroid),FSS.Vector3.normalise(s.ray),o=FSS.Vector3.dot(r.normal,s.ray),this.side===FSS.FRONT?o=Math.max(o,0):this.side===FSS.BACK?o=Math.abs(Math.min(o,0)):this.side===FSS.DOUBLE&&(o=Math.max(Math.abs(o),0)),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.ambient.rgba,s.ambient.rgba),FSS.Vector4.add(r.color.rgba,this.material.slave.rgba),FSS.Vector4.multiplyVectors(this.material.slave.rgba,this.material.diffuse.rgba,s.diffuse.rgba),FSS.Vector4.multiplyScalar(this.material.slave.rgba,o),FSS.Vector4.add(r.color.rgba,this.material.slave.rgba);FSS.Vector4.clamp(r.color.rgba,0,1)}return this},FSS.Scene=function(){this.meshes=[],this.lights=[]},FSS.Scene.prototype={add:function(e){return e instanceof FSS.Mesh&&!~this.meshes.indexOf(e)?this.meshes.push(e):e instanceof FSS.Light&&!~this.lights.indexOf(e)&&this.lights.push(e),this},remove:function(e){return e instanceof FSS.Mesh&&~this.meshes.indexOf(e)?this.meshes.splice(this.meshes.indexOf(e),1):e instanceof FSS.Light&&~this.lights.indexOf(e)&&this.lights.splice(this.lights.indexOf(e),1),this}},FSS.Renderer=function(){this.width=0,this.height=0,this.halfWidth=0,this.halfHeight=0},FSS.Renderer.prototype={setSize:function(e,t){return this.width!==e||this.height!==t?(this.width=e,this.height=t,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this):void 0},clear:function(){return this},render:function(){return this}},FSS.CanvasRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.context=this.element.getContext("2d"),this.setSize(this.element.width,this.element.height)},FSS.CanvasRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.CanvasRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.width=e,this.element.height=t,this.context.setTransform(1,0,0,-1,this.halfWidth,this.halfHeight),this},FSS.CanvasRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.context.clearRect(-this.halfWidth,-this.halfHeight,this.width,this.height),this},FSS.CanvasRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,n,r,i,s;for(this.clear(),this.context.lineJoin="round",this.context.lineWidth=1,t=e.meshes.length-1;t>=0;t--)if(n=e.meshes[t],n.visible)for(n.update(e.lights,!0),r=n.geometry.triangles.length-1;r>=0;r--)i=n.geometry.triangles[r],s=i.color.format(),this.context.beginPath(),this.context.moveTo(i.a.position[0],i.a.position[1]),this.context.lineTo(i.b.position[0],i.b.position[1]),this.context.lineTo(i.c.position[0],i.c.position[1]),this.context.closePath(),this.context.strokeStyle=s,this.context.fillStyle=s,this.context.stroke(),this.context.fill();return this},FSS.WebGLRenderer=function(){FSS.Renderer.call(this),this.element=document.createElement("canvas"),this.element.style.display="block",this.vertices=null,this.lights=null;var e={preserveDrawingBuffer:!1,premultipliedAlpha:!0,antialias:!0,stencil:!0,alpha:!0};return this.gl=this.getContext(this.element,e),this.unsupported=!this.gl,this.unsupported?"WebGL is not supported by your browser.":(this.gl.clearColor(0,0,0,0),this.gl.enable(this.gl.DEPTH_TEST),this.setSize(this.element.width,this.element.height),void 0)},FSS.WebGLRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.WebGLRenderer.prototype.getContext=function(e,t){var n=!1;try{if(!(n=e.getContext("experimental-webgl",t)))throw"Error creating WebGL context."}catch(r){console.error(r)}return n},FSS.WebGLRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.unsupported?void 0:(this.element.width=e,this.element.height=t,this.gl.viewport(0,0,e,t),this)},FSS.WebGLRenderer.prototype.clear=function(){return FSS.Renderer.prototype.clear.call(this),this.unsupported?void 0:(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this)},FSS.WebGLRenderer.prototype.render=function(e){if(FSS.Renderer.prototype.render.call(this,e),!this.unsupported){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=!1,g=e.lights.length,y=0;if(this.clear(),this.lights!==g){if(this.lights=g,!(this.lights>0))return;this.buildProgram(g)}if(this.program){for(t=e.meshes.length-1;t>=0;t--)n=e.meshes[t],n.geometry.dirty&&(m=!0),n.update(e.lights,!1),y+=3*n.geometry.triangles.length;if(m||this.vertices!==y){this.vertices=y;for(a in this.program.attributes){for(l=this.program.attributes[a],l.data=new FSS.Array(y*l.size),p=0,t=e.meshes.length-1;t>=0;t--)for(n=e.meshes[t],r=0,i=n.geometry.triangles.length;i>r;r++)for(s=n.geometry.triangles[r],d=0,v=s.vertices.length;v>d;d++){switch(vertex=s.vertices[d],a){case"side":this.setBufferData(p,l,n.side);break;case"position":this.setBufferData(p,l,vertex.position);break;case"centroid":this.setBufferData(p,l,s.centroid);break;case"normal":this.setBufferData(p,l,s.normal);break;case"ambient":this.setBufferData(p,l,n.material.ambient.rgba);break;case"diffuse":this.setBufferData(p,l,n.material.diffuse.rgba)}p++}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,l.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,l.data,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(l.location),this.gl.vertexAttribPointer(l.location,l.size,this.gl.FLOAT,!1,0,0)}}for(this.setBufferData(0,this.program.uniforms.resolution,[this.width,this.height,this.width]),o=g-1;o>=0;o--)u=e.lights[o],this.setBufferData(o,this.program.uniforms.lightPosition,u.position),this.setBufferData(o,this.program.uniforms.lightAmbient,u.ambient.rgba),this.setBufferData(o,this.program.uniforms.lightDiffuse,u.diffuse.rgba);for(f in this.program.uniforms)switch(l=this.program.uniforms[f],h=l.location,c=l.data,l.structure){case"3f":this.gl.uniform3f(h,c[0],c[1],c[2]);break;case"3fv":this.gl.uniform3fv(h,c);break;case"4fv":this.gl.uniform4fv(h,c)}}return this.gl.drawArrays(this.gl.TRIANGLES,0,this.vertices),this}},FSS.WebGLRenderer.prototype.setBufferData=function(e,t,n){if(FSS.Utils.isNumber(n))t.data[e*t.size]=n;else for(var r=n.length-1;r>=0;r--)t.data[e*t.size+r]=n[r]},FSS.WebGLRenderer.prototype.buildProgram=function(e){if(!this.unsupported){var t=FSS.WebGLRenderer.VS(e),n=FSS.WebGLRenderer.FS(e),r=t+n;if(!this.program||this.program.code!==r){var i=this.gl.createProgram(),s=this.buildShader(this.gl.VERTEX_SHADER,t),o=this.buildShader(this.gl.FRAGMENT_SHADER,n);if(this.gl.attachShader(i,s),this.gl.attachShader(i,o),this.gl.linkProgram(i),!this.gl.getProgramParameter(i,this.gl.LINK_STATUS)){var u=this.gl.getError(),a=this.gl.getProgramParameter(i,this.gl.VALIDATE_STATUS);return console.error("Could not initialise shader.\nVALIDATE_STATUS: "+a+"\nERROR: "+u),null}return this.gl.deleteShader(o),this.gl.deleteShader(s),i.code=r,i.attributes={side:this.buildBuffer(i,"attribute","aSide",1,"f"),position:this.buildBuffer(i,"attribute","aPosition",3,"v3"),centroid:this.buildBuffer(i,"attribute","aCentroid",3,"v3"),normal:this.buildBuffer(i,"attribute","aNormal",3,"v3"),ambient:this.buildBuffer(i,"attribute","aAmbient",4,"v4"),diffuse:this.buildBuffer(i,"attribute","aDiffuse",4,"v4")},i.uniforms={resolution:this.buildBuffer(i,"uniform","uResolution",3,"3f",1),lightPosition:this.buildBuffer(i,"uniform","uLightPosition",3,"3fv",e),lightAmbient:this.buildBuffer(i,"uniform","uLightAmbient",4,"4fv",e),lightDiffuse:this.buildBuffer(i,"uniform","uLightDiffuse",4,"4fv",e)},this.program=i,this.gl.useProgram(this.program),i}}},FSS.WebGLRenderer.prototype.buildShader=function(e,t){if(!this.unsupported){var n=this.gl.createShader(e);return this.gl.shaderSource(n,t),this.gl.compileShader(n),this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)?n:(console.error(this.gl.getShaderInfoLog(n)),null)}},FSS.WebGLRenderer.prototype.buildBuffer=function(e,t,n,r,i,s){var o={buffer:this.gl.createBuffer(),size:r,structure:i,data:null};switch(t){case"attribute":o.location=this.gl.getAttribLocation(e,n);break;case"uniform":o.location=this.gl.getUniformLocation(e,n)}return s&&(o.data=new FSS.Array(s*r)),o},FSS.WebGLRenderer.VS=function(e){var t=["precision mediump float;","#define LIGHTS "+e,"attribute float aSide;","attribute vec3 aPosition;","attribute vec3 aCentroid;","attribute vec3 aNormal;","attribute vec4 aAmbient;","attribute vec4 aDiffuse;","uniform vec3 uResolution;","uniform vec3 uLightPosition[LIGHTS];","uniform vec4 uLightAmbient[LIGHTS];","uniform vec4 uLightDiffuse[LIGHTS];","varying vec4 vColor;","void main() {","vColor = vec4(0.0);","vec3 position = aPosition / uResolution * 2.0;","for (int i = 0; i < LIGHTS; i++) {","vec3 lightPosition = uLightPosition[i];","vec4 lightAmbient = uLightAmbient[i];","vec4 lightDiffuse = uLightDiffuse[i];","vec3 ray = normalize(lightPosition - aCentroid);","float illuminance = dot(aNormal, ray);","if (aSide == 0.0) {","illuminance = max(illuminance, 0.0);","} else if (aSide == 1.0) {","illuminance = abs(min(illuminance, 0.0));","} else if (aSide == 2.0) {","illuminance = max(abs(illuminance), 0.0);","}","vColor += aAmbient * lightAmbient;","vColor += aDiffuse * lightDiffuse * illuminance;","}","vColor = clamp(vColor, 0.0, 1.0);","gl_Position = vec4(position, 1.0);","}"].join("\n");return t},FSS.WebGLRenderer.FS=function(){var e=["precision mediump float;","varying vec4 vColor;","void main() {","gl_FragColor = vColor;","}"].join("\n");return e},FSS.SVGRenderer=function(){FSS.Renderer.call(this),this.element=document.createElementNS(FSS.SVGNS,"svg"),this.element.setAttribute("xmlns",FSS.SVGNS),this.element.setAttribute("version","1.1"),this.element.style.display="block",this.setSize(300,150)},FSS.SVGRenderer.prototype=Object.create(FSS.Renderer.prototype),FSS.SVGRenderer.prototype.setSize=function(e,t){return FSS.Renderer.prototype.setSize.call(this,e,t),this.element.setAttribute("width",e),this.element.setAttribute("height",t),this},FSS.SVGRenderer.prototype.clear=function(){FSS.Renderer.prototype.clear.call(this);for(var e=this.element.childNodes.length-1;e>=0;e--)this.element.removeChild(this.element.childNodes[e]);return this},FSS.SVGRenderer.prototype.render=function(e){FSS.Renderer.prototype.render.call(this,e);var t,n,r,i,s,o;for(t=e.meshes.length-1;t>=0;t--)if(n=e.meshes[t],n.visible)for(n.update(e.lights,!0),r=n.geometry.triangles.length-1;r>=0;r--)i=n.geometry.triangles[r],i.polygon.parentNode!==this.element&&this.element.appendChild(i.polygon),s=this.formatPoint(i.a)+" ",s+=this.formatPoint(i.b)+" ",s+=this.formatPoint(i.c),o=this.formatStyle(i.color.format()),i.polygon.setAttributeNS(null,"points",s),i.polygon.setAttributeNS(null,"style",o);return this},FSS.SVGRenderer.prototype.formatPoint=function(e){return this.halfWidth+e.position[0]+","+(this.halfHeight-e.position[1])},FSS.SVGRenderer.prototype.formatStyle=function(e){var t="fill:"+e+";";return t+="stroke:"+e+";"};FSS.Color.prototype.setHSL=function(e){e="hsl("+e.h+", "+e.s*100+"%, "+e.l*100+"%)";this.set(tinycolor(e).toHexString(),this.opacity)};FSS.Color.prototype.getHSL=function(){return tinycolor(this.hex).toHsl()};